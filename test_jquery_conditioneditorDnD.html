<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>jQuery UI TreeInTable</title>
		
        <link href="jquery-ui-1.11.4/jquery-ui.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="css/ise.treeintable.css">
		<link rel="stylesheet" type="text/css" href="css/ise.treeintable.css">
		<style>
			.cpmTable td {
				min-width: 365px;
			}
			
			.buttonclass {
				width: 365px;
			}
			
			
		</style>
</head>
	<body>
	    <div id="datastore3" class="datastore"></div>
    	<div id="treeintable3" class="treeintable">Condition Editor (Drag and Drop) </div> 
    	<br/><br/>   	
        <textarea rows="20" cols="50" id="textarea" >(sourceIp=="10.1.2.49")||(priority >= 1 )&& (device !="linksys")</textarea>
        <br/><br/> 
        <input class ="buttonclass" type="button" id="load" value="Parse Expression To Condition Tree" style="width ="/>
         <br/><br/>
        <input class ="buttonclass" type="button" id="math" value="Get Boolean Expression From Condition Tree" />
      
		
		<script src="jquery-ui-1.11.4/external/jquery/jquery.js"></script>
		<script src="jquery-ui-1.11.4/jquery-ui.js"></script>
 
        <script type="text/javascript" src="js/jquery.ise.datastore.js"></script> 
        <script type="text/javascript" src="js/jquery.ise.treeintable.js"></script>
        <script type="text/javascript" src="js/jquery.ise.conditioneditor.js"></script>
        <script type="text/javascript" src="js/esprima.js"></script>
       <script>
       var treeintableWidget3= null;
       var storeWidget3= null;
       
		$(document).ready(function(){
		    $("#load").click(function(){
		    	 //alert("Value: " + $("#textarea").val());
		    	 var mathString = $("#textarea").val();
		    	 if (mathString.trim().length==0) return;
		    	 try{
		    		 var mathJson =esprima.parse(mathString);		    		 
		    		 
		    		 //treeintableWidget3.element.children()[0].remove();  //failed in IE and Safari
		    		$(treeintableWidget3.element).empty();
		    		
		    		 var store3 =$( "<div></div>" )
		 		    .appendTo( "body" )
		 		    .datastore({
		 		    	data: mathJson,
		 		    	// once receives "complete" event from "datastore" object. carry on this function
		 		        complete: function( event, data ) {
		 		        	loadConditionEditor(event, data);		        	
		 		        }
		 		    });
		    	 }catch (e){
		    		 alert(e);
		    	 }
		    });
		    
		    $("#math").click(function(){
		    	var mathString = treeintableWidget3.getMathExpression();
		    	alert("Boolean Expresson:\n" + mathString);
		    });
		});
		
		var loadConditionEditor = function( event, data ) {
            console.log( "datastore build complete" );
            //instantiate "treeintable" object.
            var treeinTableNode =$("#treeintable3").conditioneditor({ store: store3});
            storeWidget3= treeinTableNode.data("iseConditioneditor").store;  //"treeintable" old code
            treeintableWidget3=treeinTableNode.data("iseConditioneditor");
            treeintableWidget3.decorateTablerow=function(cpmTableRow){
            	//instance level override the class api
            	//console.log("instance override decorateTablerow()");
            };
            treeintableWidget3.onRowSelect=function(trNode){
				console.log("TreeInColumnable-items onRowSelect()" + trNode.treetableArrayItem);
				
				
				// for debugging. Test various api 
				//console.log("Validation Error List\n" + treeintableWidget3.validate());
				// console.log("getChildItemIndex(): " + treeintableWidget3.getChildItemIndex(trNode));
				// console.log(treeintableWidget3.getParentRowItem(trNode));
				// console.log(treeintableWidget3.getSubTree(trNode));
				// console.log(treeintableWidget3.getDirectChildren(trNode));
				// console.log(treeintableWidget3.getParentRowItemsList(trNode));
				// console.log(treeintableWidget3.getChildIndexOfParent(trNode));
				// console.log(treeintableWidget3.getPreviousSiblingRowItem(trNode));
				// console.log(treeintableWidget3.getNexeSiblingRowItem(trNode));  
				//console.log("getRootLevelRowItems() " + treeintableWidget3.getRootLevelRowItems());
			};
			treeintableWidget3.shouldThisAttributeHaveExpandie=function(attribute){
	        // Overridable api which  determine this attribute need to present expandie icon
				return (attribute=="expression");  // this is the column showing tree
			};

			// table headers and display attribute should be matching.
			treeintableWidget3.getProcessAttributes=function(storeAttributes){
			   return ['expression'];
			   //return storeAttributes;
			};
			treeintableWidget3.getHeaderDisplayNames=function(){
			   return ['Expression'];  //return ['logical',  'operator' ];
			};
		 
            treeintableWidget3.buildTreeTable();  
            treeintableWidget3.setTreetableDragAndDrop(); ////<------ enable Drag-and-Drop
        }
		</script>
        <script type="text/javascript">
           
            var store3 =$( "<div></div>" )
		    //.appendTo( "body" )
		    .datastore({
		    	url: "data/test_ce.json",  // it is /* (priority==5) || (souceIp=="1.2.2.3") && ( device=="router") */
		    	// once receives "complete" event from "datastore" object. carry on this function
		        complete: function( event, data ) {
		        	loadConditionEditor(event, data);		        	
		        }
		    });
            
            
        	
		</script>
	</body>
</html>